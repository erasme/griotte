<!DOCTYPE html>
<html>
  <head>
    <title>Griotte Server</title>
    <link rel="icon" type="image/png" href="/img/raspberry_pi.png">
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">

    <style type="text/css">
      #graph-container {
        width : 400px;
        height: 200px;
        margin: 8px auto;
      }
    </style>

    <link rel="stylesheet" href="/css/jquery-ui-1.9.2.css" type="text/css" media="screen">
    <link rel="stylesheet" href="/css/jquery.mobile-1.4.0-rc.1.css" type="text/css" media="screen">
    <link rel="stylesheet" type="text/css" href="css/common.css">
    <link rel="stylesheet" type="text/css" href="css/style.css">

    <script type="text/javascript" src="/js/jquery-1.9.1.js"></script>
    <script type="text/javascript" src="/js/jquery-ui-1.9.2-min.js"></script>
    <script type="text/javascript" src="/js/jquery.mobile-1.4.0-rc.1.js"></script>
    <script type="text/javascript" src="/js/flotr2.min.js"></script>
    <script type="text/javascript" src="js/blockly/blockly_compressed.js"></script>
    <script type="text/javascript" src="js/blockly/blocks_compressed.js"></script>
    <script type="text/javascript" src="js/scenario.js"></script>
    <script type="text/javascript" src="js/application.js"></script>
    <script type="text/javascript" src="js/griotte.js"></script>
    <script type="text/javascript" src="js/blockly/core/medias.js"></script>
    <script type="text/javascript" src="js/blockly/core/field_media.js"></script>
    <script type="text/javascript" src="js/blockly/blocks/analog.js"></script>
    <script type="text/javascript" src="js/blockly/blocks/digital.js"></script>
    <script type="text/javascript" src="js/blockly/blocks/rfid.js"></script>
    <script type="text/javascript" src="js/blockly/blocks/multimedia.js"></script>
    <script type="text/javascript" src="js/blockly/blocks/dmx.js"></script>
    <script type="text/javascript" src="js/blockly/blocks/monkey_patching.js"></script>
    <script type="text/javascript" src="js/blockly/python_compressed.js"></script>
    <script type="text/javascript" src="js/blockly/generators/python/analog.js"></script>
    <script type="text/javascript" src="js/blockly/generators/python/digital.js"></script>
    <script type="text/javascript" src="js/blockly/generators/python/rfid.js"></script>
    <script type="text/javascript" src="js/blockly/generators/python/multimedia.js"></script>
    <script type="text/javascript" src="js/blockly/generators/python/dmx.js"></script>
    <script type="text/javascript" src="js/blockly/generators/python/monkey_patching.js"></script>
    <script type="text/javascript" src="js/blockly/msg/fr_monkey_patching.js"></script>
    <script type="text/javascript" src="js/scenario.js"></script>
  </head>

  <body>
    <div data-role="page" id="page-control">
      <div data-role="header">
        <div data-role="navbar" data-iconpos="bottom">
          <ul>
            <li><a href="#page-control" data-icon="grid" class="ui-state-persist ui-btn-active">Contrôle</a></li>
            <li><a href="#page-scenario" data-icon="gear">Scenario</a></li>
            <li><a href="#page-medias" data-icon="info">Médias</a></li>
            <li><a href="#page-monitor" data-icon="alert">Moniteur</a></li>
          </ul>
        </div> <!-- /navbar -->
      </div> <!-- header -->

      <div data-role="content">
        <h3>En cours</h3>
        Média <strong><span id="media-name">Aucun</span></strong> <em>(durée: <span id="media-duration"></span>s)</em>
        <div data-role="fieldcontain">
          <label for="slider-current">Progression (s)</label>
          <input name="slider-current" id="slider-current" data-mini="true" min="0" max="100" value="0" type="range" data-highlight="true">
        </div>

        <h3>Réglages</h3>
        <form>
          <div data-role="fieldcontain">
            <label for="toggle-sound">Son</label>
            <select name="toggle-sound" id="toggle-sound" data-role="slider" data-mini="true">
              <option value="off">Off</option>
              <option value="on">On</option>
            </select>
          </div>
          <div data-role="fieldcontain">
            <label for="slider-sound">Volume général (%)</label>
            <input type="range" step="10" name="slider-sound" id="slider-sound" value="20" min="0" max="120" data-highlight="true" data-mini="true">
          </div>
        </form>

        <h3>Capteurs</h3>

        <form>
          <fieldset data-role="controlgroup" data-type="horizontal" >
            <input type="radio" name="radio-range" id="radio-1sec" value="1sec" data-mini="true" />
            <label for="radio-1sec">1 second</label>

            <input type="radio" name="radio-range" id="radio-10secs" value="10secs" data-mini="true" checked="checked" />
            <label for="radio-10secs">10 seconds</label>

            <input type="radio" name="radio-range" id="radio-1min" value="1min" data-mini="true" />
            <label for="radio-1min">1 minute</label>
          </fieldset>
        </form>

        <div class="ui-grid-a">
          <div class="ui-block-a" data-role="content" id="graph-an-container" style="height:240px;margin: 8px auto;"></div>
          <div class="ui-block-b" data-role="content" id="graph-io-container" style="height:240px;margin: 8px auto;"></div>
        </div>


      </div> <!-- content -->

      <div data-role="footer">
        <h4>Griotte - &copy; ERASME 2013-2014</h4>
      </div><!-- /footer -->

    </div> <!-- /page page-control -->

    <div data-role="page" id="page-scenario">
      <div data-role="header">
        <div data-role="navbar" data-iconpos="bottom">
          <ul>
            <li><a href="#page-control" data-icon="grid">Contrôle</a></li>
            <li><a href="#page-scenario" data-icon="gear" class="ui-state-persist ui-btn-active">Scenario</a></li>
            <li><a href="#page-medias" data-icon="info">Médias</a></li>
            <li><a href="#page-monitor" data-icon="alert">Moniteur</a></li>
          </ul>
        </div><!-- /navbar -->
      </div><!-- header -->

      <div data-role="content">
        <div id="content_area"> <!--  style="height: 60%; width: 60%;"> -->
        </div>
      </div> <!-- content -->

      <div data-role="footer" data-position="fixed">
        <div class="ui-grid-b">
          <div class="ui-block-a">
            <div data-role="controlgroup" data-type="horizontal">
            <label for="select-scenario" class="select">Scenario:</label style="display: none;">
              <select id="select-scenario" data-inline="true" data-native-menu="false" data-iconpos="left">
                  <option>Ouvrir...</option>
              </select>

              <input type="button" value="Poubelle" data-inline="true" id="scenario-trash" data-icon="delete" >
            </div>
          </div>
          <div class="ui-block-b">
              <input type="text" name="name" placeholder="Nom du scénario" id="scenario-name" value="" data-inline="true" />
          </div>
          <div class="ui-block-c">
            <input type="button" value="Enregister" data-inline="true" id="scenario-save" data-disabled="true" data-icon="arrow-u">
          </div>
        </div>
      </div>

    </div> <!-- page page-scenario-->

    <div data-role="page" id="page-medias">
      <div data-role="header">
        <div data-role="navbar" data-iconpos="bottom">
          <ul>
            <li><a href="#page-control" data-icon="grid">Contrôle</a></li>
            <li><a href="#page-scenario" data-icon="gear">Scenario</a></li>
            <li><a href="#page-medias" data-icon="info" class="ui-state-persist ui-btn-active">Médias</a></li>
            <li><a href="#page-monitor" data-icon="alert">Moniteur</a></li>
          </ul>
        </div><!-- /navbar -->

      </div>

      <div data-role="content">
        <div class="content-primary">
          <h3>Upload</h3>

          <div id="upload-slider-container">
            <input type="range" id="upload-progress" data-highlight="true" min="0" max="100" value="50">
          </div>

          <form id="upload-form" enctype="multipart/form-data" action="/upload" method="post" data-ajax="false">
            <div data-role="fieldcontain">
              <fieldset data-role="controlgroup" data-type="horizontal">
                <input type="file" id="filearg" name="filearg" />
                <input type="submit" value="Upload" />
              </fieldset>
            </div>
          </form>

          <h3>Médias</h3>




          <button type="button" data-icon="plus" data-iconpos="right" data-mini="true" data-inline="true" id="expand">Ajouter</button>

          <div data-role="collapsible-set" data-iconpos="right" id="set">
            <div data-role="collapsible" class="custom-collapsible" id="video-collapsible" data-collapsed-icon="carat-d" data-expanded-icon="carat-u">
              <h3>Vidéos</h3>
              <ul id="video-list" data-role="listview" data-split-icon="delete" data-inset="true">
              </ul>
            </div>
            <div data-role="collapsible" class="custom-collapsible" id="image-collapsible" data-collapsed="true" data-collapsed-icon="carat-d" data-expanded-icon="carat-u">
              <h3>Images</h3>
              <ul id="image-list" data-role="listview" data-split-icon="delete" data-inset="true">
              </ul>
            </div>
            <div data-role="collapsible" class="custom-collapsible" id="audio-collapsible" data-collapsed="true" data-collapsed-icon="carat-d" data-expanded-icon="carat-u">
              <h3>Sons</h3>
              <ul id="audio-list" data-role="listview" data-split-icon="delete" data-inset="true">
              </ul>
            </div>
            <div data-role="collapsible" class="custom-collapsible" id="scenario-collapsible" data-collapsed="true" data-collapsed-icon="carat-d" data-expanded-icon="carat-u">
              <h3>Scenarios</h3>
              <div id="scenario-list">
              <!-- <ul id="scenario-list" data-split-theme="a" data-split-icon="delete" data-inset="true">
              </ul> -->
              </div>
            </div>

          </div>


          <h3>Cartels</h3>
          <ul data-role="listview">
            <li data-role="list-divider">Demo</li>
            <li><a href="/cartels/demo/fr/index.html" target="_blank">fr</a></li>
            <li><a href="/cartels/demo/en/index.html" target="_blank">en</a></li>
            <li data-role="list-divider">Demo</li>
            <li><a href="/cartels/demo/fr/index.html" target="_blank">fr</a></li>
            <li><a href="/cartels/demo/en/index.html" target="_blank">en</a></li>
          </ul>
        </div>
      </div> <!-- content -->
      <div data-role="footer">
        <h4>Griotte - &copy; ERASME 2013-2014</h4>
      </div><!-- /footer -->
    </div> <!-- page page-medias-->

    <div data-role="page" id="page-monitor">
      <div data-role="header">
        <div data-role="navbar" data-iconpos="bottom">
          <ul>
            <li><a href="#page-control" data-icon="grid">Contrôle</a></li>
            <li><a href="#page-scenario" data-icon="gear">Scenario</a></li>
            <li><a href="#page-medias" data-icon="info">Médias</a></li>
            <li><a href="#page-monitor" data-icon="alert" class="ui-state-persist ui-btn-active">Moniteur</a></li>
          </ul>
        </div><!-- /navbar -->

      </div>

      <div data-role="content">

        <div data-role="collapsible-set">
          <div data-role="collapsible">
            <h3>Services</h3>
            <p>Liste des services en cours de fonctionnment</p>

            <div data-role="fieldcontain">
              <label for="slider_runner">Runner</label>
              <select name="slider_runner" id="slider_runner" data-role="slider" data-mini="true">
                <option value="off">Off</option>
                <option value="on" selected>On</option>
              </select>

            </div> <!-- fieldcontain -->
            <div data-role="fieldcontain">
              <label for="slider_videoclient">Video/Son</label>
              <select name="slider_videoclient" id="slider_videoclient" data-role="slider" data-mini="true">
                <option value="off">Off</option>
                <option value="on" selected>On</option>
              </select>
            </div> <!-- fieldcontain -->
            <div data-role="fieldcontain">
              <label for="slider_imageclient">Image</label>
              <select name="slider_imageclient" id="slider_imageclient" data-role="slider" data-mini="true">
                <option value="off">Off</option>
                <option value="on">On</option>
              </select>
            </div> <!-- fieldcontain -->
            <div data-role="fieldcontain">
              <label for="slider_analog">Capteurs analogiques</label>
              <select name="slider_analog" id="slider_analog" data-role="slider" data-mini="true">
                <option value="off">Off</option>
                <option value="on" selected>On</option>
              </select>
            </div> <!-- fieldcontain -->
            <div data-role="fieldcontain">
              <label for="slider_digital">Capteurs digitaux</label>
              <select name="slider_digital" id="slider_digital" data-role="slider" data-mini="true">
                <option value="off">Off</option>
                <option value="on">On</option>
              </select>
            </div> <!-- fieldcontain -->
          </div> <!-- collapsible -->

          <div data-role="collapsible">
            <h3>Capteurs</h3>
            <p>État des capteurs</p>

            <ul data-role="listview">
              <li data-role="list-divider">Analogiques</li>
              <li><a href="#analog0" data-rel="dialog">AN0</a></li>
              <li><a href="#analog1" data-rel="dialog">AN1</a></li>
              <li><a href="#analog2" data-rel="dialog">AN2</a></li>
              <li><a href="#analog3" data-rel="dialog">AN3</a></li>
              <li data-role="list-divider">Digitaux</li>
              <li><a href="#digital0" data-rel="dialog">IO0</a></li>
              <li><a href="#digital1" data-rel="dialog">IO1</a></li>
              <li><a href="#digital2" data-rel="dialog">IO2</a></li>
              <li><a href="#digital3" data-rel="dialog">IO3</a></li>
            </ul>

          </div>

          <div data-role="collapsible">
            <h3>Automatisation</h3>
            <p>Arrêt automatique</p>

            <div data-role="fieldcontain">
              <label for="autoshutdown">Arrêt automatique</label>
              <input type="checkbox" name="autoshutdown" id="autoshutdown" class="custom" />
              <label for="time">Heure d'arrêt</label>
              <input type="time" name="time" id="time" value="" />
              <label for="projector">Coupure du vidéo projecteur</label>
              <input type="checkbox" name="projector" id="projector" class="custom" />
            </div>

          </div>

          <div data-role="collapsible">
            <h3>Logs</h3>
            <p>Logs des services en cours</p>


            <fieldset data-role="controlgroup" data-type="horizontal">
              <input name="log-level-debug" id="log-level-debug" value="on" checked="checked" type="checkbox">
              <label for="log-level-debug">Debug</label>
              <input name="log-level-info" id="log-level-info" value="off" type="checkbox">
              <label for="log-level-info">Info</label>
              <input name="log-level-warn" id="log-level-warn" value="other" type="checkbox">
              <label for="log-level-warn">Warn</label>
              <input name="log-level-error" id="log-level-error" value="other" type="checkbox">
              <label for="log-level-error">Error</label>
              <input name="log-level-fatal" id="log-level-fatal" value="other" type="checkbox">
              <label for="log-level-fatal">Fatal</label>
            </fieldset>
            <label for="log-filter">Filtre</label>
            <input name="log-filter" type="text" value="sound/*">

            <textarea cols="40" rows="25" name="textarea" id="textarea">
            </textarea>
          </div> <!-- collapsible -->
        </div> <!-- collapsible-set -->
        <div data-role="footer">
          <h4>Griotte - &copy; ERASME 2013-2014</h4>
        </div><!-- /footer -->

      </div> <!-- content -->

    </div> <!-- page page-monitor -->

    <div data-role="page" id="page-popup" data-dialog="true">
      <div data-role="header">
        <h1 id="popup-title">Error uploading file</h1>
      </div>

      <div data-role="footer">
        <h1>Sorry about that !</h1>
      </div>
    </div>

    <div data-role="page" id="analog0">
      <div data-role="header">
        <h1>Analog 0</h1>
      </div>

      <div data-role="content">
        <div id="graph-container"></div>
      </div> <!-- content -->
    </div> <!-- page  -->

    <xml id="toolbox" style="display: none">
      <category name="Capteurs">
        <category name="Analogiques">
          <block type="analog_sensor"></block>
        </category>
        <category name="Digitaux">
          <block type="digital_sensor"></block>
          <block type="digital_sensor_edge"></block>
        </category>
        <category name="RFID">
          <block type="rfid_read"></block>
          <block type="rfid_wait_for"></block>
          <block type="rfid_tag"></block>
        </category>
      </category>
      <category name="Multimédia">
        <block type="multimedia_video_play"></block>
        <block type="multimedia_audio_play"></block>
        <block type="multimedia_image_play"></block>
        <block type="multimedia_video_stop"></block>
        <block type="multimedia_audio_stop"></block>
        <block type="multimedia_set_background"></block>
        <block type="multimedia_wait"></block>
        <block type="multimedia_volume"></block>
      </category>
      <category name="DMX">
        <block type="dmx_send_single"></block>
        <block type="dmx_send_channels"></block>
        <block type="dmx_blackout"></block>
      </category>
      <category name="Logique">
        <block type="controls_if"></block>
        <block type="logic_compare"></block>
        <block type="logic_operation"></block>
        <block type="logic_negate"></block>
        <block type="logic_boolean"></block>
        <block type="logic_null"></block>
        <block type="logic_ternary"></block>
      </category>
      <category name="Boucles">
        <block type="controls_repeat_forever"></block>
        <block type="controls_repeat_ext">
          <value name="TIMES">
            <block type="math_number">
              <title name="NUM">10</title>
            </block>
          </value>
        </block>
        <block type="controls_whileUntil"></block>
        <block type="controls_for">
          <value name="FROM">
            <block type="math_number">
              <title name="NUM">1</title>
            </block>
          </value>
          <value name="TO">
            <block type="math_number">
              <title name="NUM">10</title>
            </block>
          </value>
          <value name="BY">
            <block type="math_number">
              <title name="NUM">1</title>
            </block>
          </value>
        </block>
        <block type="controls_forEach"></block>
        <block type="controls_flow_statements"></block>
      </category>
      <category name="Math">
        <block type="math_number"></block>
        <block type="math_arithmetic"></block>
        <block type="math_single"></block>
        <block type="math_trig"></block>
        <block type="math_constant"></block>
        <block type="math_number_property"></block>
        <block type="math_change">
          <value name="DELTA">
            <block type="math_number">
              <title name="NUM">1</title>
            </block>
          </value>
        </block>
        <block type="math_round"></block>
        <block type="math_on_list"></block>
        <block type="math_modulo"></block>
        <block type="math_constrain">
          <value name="LOW">
            <block type="math_number">
              <title name="NUM">1</title>
            </block>
          </value>
          <value name="HIGH">
            <block type="math_number">
              <title name="NUM">100</title>
            </block>
          </value>
        </block>
        <block type="math_random_int">
          <value name="FROM">
            <block type="math_number">
              <title name="NUM">1</title>
            </block>
          </value>
          <value name="TO">
            <block type="math_number">
              <title name="NUM">100</title>
            </block>
          </value>
        </block>
        <block type="math_random_float"></block>
      </category>
      <category name="Texte">
        <block type="text"></block>
        <block type="text_join"></block>
        <block type="text_append">
          <value name="TEXT">
            <block type="text"></block>
          </value>
        </block>
        <block type="text_length"></block>
        <block type="text_isEmpty"></block>
        <block type="text_indexOf">
          <value name="VALUE">
            <block type="variables_get">
              <title name="VAR">texte</title>
            </block>
          </value>
        </block>
        <block type="text_charAt">
          <value name="VALUE">
            <block type="variables_get">
              <title name="VAR">texte</title>
            </block>
          </value>
        </block>
        <block type="text_getSubstring">
          <value name="STRING">
            <block type="variables_get">
              <title name="VAR">texte</title>
            </block>
          </value>
        </block>
        <block type="text_changeCase"></block>
        <block type="text_trim"></block>
        <block type="text_print"></block>
        <block type="text_prompt"></block>
      </category>
      <category name="Listes">
        <block type="lists_create_empty"></block>
        <block type="lists_create_with"></block>
        <block type="lists_repeat">
          <value name="NUM">
            <block type="math_number">
              <title name="NUM">5</title>
            </block>
          </value>
        </block>
        <block type="lists_length"></block>
        <block type="lists_isEmpty"></block>
        <block type="lists_indexOf">
          <value name="VALUE">
            <block type="variables_get">
              <title name="VAR">liste</title>
            </block>
          </value>
        </block>
        <block type="lists_getIndex">
          <value name="VALUE">
            <block type="variables_get">
              <title name="VAR">liste</title>
            </block>
          </value>
        </block>
        <block type="lists_setIndex">
          <value name="LIST">
            <block type="variables_get">
              <title name="VAR">liste</title>
            </block>
          </value>
        </block>
        <block type="lists_getSublist">
          <value name="LIST">
            <block type="variables_get">
              <title name="VAR">liste</title>
            </block>
          </value>
        </block>
      </category>
      <category name="Couleur">
        <block type="colour_picker"></block>
        <block type="colour_random"></block>
        <block type="colour_rgb"></block>
        <block type="colour_blend"></block>
      </category>
      <category name="Variables" custom="VARIABLE"></category>
      <category name="Procédures" custom="PROCEDURE"></category>
    </xml>

  </body>

  <script type="text/javascript">
//$( document ).bind("pageinit", function( event ) {
  // function pausecomp(ms) {
  //   ms += new Date().getTime();
  //   while (new Date() < ms){}
  // }
$( document ).ready( function( event ) {
  var scheme = window.location.protocol,
      host   = location.hostname,
      port   = 8888, // location.port,
      path   = '/ws';

  $('#content_area').height($(window).height()*0.8);
  Griotte.init('ws://' + host + (port ? ':' + port : '') + path);
  Application.init();
  //$("#page-scenario").trigger('refresh');
});

$("#page-scenario").on("pageshow", function() {
  console.log("PAGESHOW hit !");
  if (!Code.griotte) {
    Code.init("content_area");
  }
  Code.refresh_scenario_list();
});

</script>

</html>

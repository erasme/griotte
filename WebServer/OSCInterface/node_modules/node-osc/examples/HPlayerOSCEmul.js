var osc = require('../lib/osc.js');
var util = require('util');
var HPlayer = require('../../../../HPlayer.js');

var player = new HPlayer();

player.media.filepath = '';

var client = new osc.Client('127.0.0.1', 9001);


var oscServer = new osc.Server(9000, '127.0.0.1');

oscServer.on("/s/getStatus", function (msg, rinfo) {
    console.log("getStatus:");
    console.log(msg);
    
    var state = player.isPlaying ? (player.isPaused ? "paused" : "playing") : "stoped" ;
    
    client.send('/status', player.name, state, player.media.filepath, 30000,50000 ,player.volume, player.isMuted ? "muted":"unmuted");

});


oscServer.on("/play", function (msg, rinfo) {
    console.log("Play:");
    console.log(msg);
    
    player.isPlaying = true;
    
    player.media.filepath = msg[1];
    
    client.send('/status', player.name, "playing", player.media.filepath, 30000,50000 ,player.volume, player.isMuted ? "muted":"unmuted");
});
oscServer.on("/playloop", function (msg, rinfo) {
    console.log("Play Loop:");
    console.log(msg);
    
    player.isPlaying = true;
    
    player.media.filepath = msg[1];
    
    client.send('/status', player.name, "playing", player.media.filepath, 30000,50000 ,player.volume, player.isMuted ? "muted":"unmuted");
});
oscServer.on("/stop", function (msg, rinfo) {
    console.log("Stop:");
    console.log(msg);
    
    player.isPlaying = player.isPaused = false;
    
    client.send('/status', player.name, "stoped", player.media.filepath, 30000, 50000, player.volume, player.isMuted ? "muted":"unmuted");
});
oscServer.on("/pause", function (msg, rinfo) {
    console.log("Pause:");
    console.log(msg);
    
    player.isPaused = true;
    
    client.send('/status', player.name, "paused", player.media.filepath, 30000, 50000, player.volume, player.isMuted ? "muted":"unmuted");
});
oscServer.on("/resume", function (msg, rinfo) {
    console.log("Resume:");
    console.log(msg);
    
    player.isPaused = false; 
    
    client.send('/status', player.name, "playing", player.media.filepath, 30000, 50000, player.volume, player.isMuted ? "muted":"unmuted");
});
oscServer.on("/volume", function (msg, rinfo) {
    console.log("volume:");
    console.log(msg);
    
    player.volume = msg[1];
    
    var state = player.isPlaying ? (player.isPaused ? "paused" : "playing") : "stoped" ;
    
    client.send('/status', player.name, state, player.media.filepath, 30000, 50000, player.volume, player.isMuted ? "muted":"unmuted");
});

oscServer.on("/mute", function (msg, rinfo) {
    console.log("mute:");
    console.log(msg);
    
    player.isMuted = true;
    
    var state = player.isPlaying ? (player.isPaused ? "paused" : "playing") : "stoped" ;
    
    client.send('/status', player.name, state, player.media.filepath, 30000, 50000, player.volume, player.isMuted ? "muted":"unmuted");
});

oscServer.on("/unmute", function (msg, rinfo) {
    console.log("unmute:");
    console.log(msg);
    
    player.isMuted = false;
    
    var state = player.isPlaying ? (player.isPaused ? "paused" : "playing") : "stoped" ;
    
    client.send('/status', player.name, state, player.media.filepath, 30000, 50000, player.volume, player.isMuted ? "muted":"unmuted");
});

{
  "name": "relais proxi",
  "type": "block",
  "xml": "<block type=\"variables_set\" id=\"173\" inline=\"true\" x=\"321\" y=\"38\"><field name=\"VAR\">seuil</field><value name=\"VALUE\"><block type=\"math_number\" id=\"174\"><field name=\"NUM\">0.15</field></block></value><next><block type=\"procedures_callnoreturn\" id=\"175\"><mutation name=\"ouvre relais\"></mutation><next><block type=\"video_play\" id=\"206\"><field name=\"VIDEO\">/home/pi/media/sintel_trailer-480p.mp4</field><field name=\"loop_cb\">TRUE</field></block></next></block></next></block><block type=\"procedures_defnoreturn\" id=\"176\" x=\"1062\" y=\"60\"><mutation></mutation><field name=\"NAME\">ouvre relais</field><statement name=\"STACK\"><block type=\"writedigital\" id=\"177\"><field name=\"valeur\">0</field><field name=\"channel\">IO3</field><next><block type=\"variables_set\" id=\"178\" inline=\"true\"><field name=\"VAR\">relais</field><value name=\"VALUE\"><block type=\"math_number\" id=\"179\"><field name=\"NUM\">0</field></block></value></block></next></block></statement></block><block type=\"procedures_defnoreturn\" id=\"180\" x=\"1064\" y=\"173\"><mutation></mutation><field name=\"NAME\">ferme relais</field><statement name=\"STACK\"><block type=\"writedigital\" id=\"181\"><field name=\"valeur\">1</field><field name=\"channel\">IO3</field><next><block type=\"variables_set\" id=\"182\" inline=\"true\"><field name=\"VAR\">relais</field><value name=\"VALUE\"><block type=\"math_number\" id=\"183\"><field name=\"NUM\">1</field></block></value></block></next></block></statement></block><block type=\"onanalog\" id=\"184\" x=\"307\" y=\"311\"><field name=\"channel\">0</field><field name=\"VAR\">v</field><comment pinned=\"false\" h=\"146\" w=\"377\">Exemple : actionne une relais en fonction de la proximité d'une personne\n\nPour faire fonctionner cet exemple :\n- brancher un relais sur IO3\n- brancher un capteur de proximité (type maxbotics EZ) sur AN0\n\n</comment><statement name=\"callback\"><block type=\"controls_if\" id=\"185\" inline=\"false\"><mutation elseif=\"1\"></mutation><value name=\"IF0\"><block type=\"logic_operation\" id=\"186\" inline=\"true\"><field name=\"OP\">AND</field><value name=\"A\"><block type=\"logic_compare\" id=\"187\" inline=\"true\"><field name=\"OP\">LT</field><value name=\"A\"><block type=\"variables_get\" id=\"188\"><field name=\"VAR\">v</field></block></value><value name=\"B\"><block type=\"variables_get\" id=\"189\"><field name=\"VAR\">seuil</field></block></value></block></value><value name=\"B\"><block type=\"logic_compare\" id=\"190\" inline=\"true\"><field name=\"OP\">EQ</field><value name=\"A\"><block type=\"variables_get\" id=\"191\"><field name=\"VAR\">relais</field></block></value><value name=\"B\"><block type=\"math_number\" id=\"192\"><field name=\"NUM\">0</field></block></value></block></value></block></value><statement name=\"DO0\"><block type=\"procedures_callnoreturn\" id=\"193\"><mutation name=\"ferme relais\"></mutation><next><block type=\"video_resume\" id=\"216\"></block></next></block></statement><value name=\"IF1\"><block type=\"logic_operation\" id=\"194\" inline=\"true\"><field name=\"OP\">AND</field><value name=\"A\"><block type=\"logic_compare\" id=\"195\" inline=\"true\"><field name=\"OP\">GTE</field><value name=\"A\"><block type=\"variables_get\" id=\"196\"><field name=\"VAR\">v</field></block></value><value name=\"B\"><block type=\"variables_get\" id=\"197\"><field name=\"VAR\">seuil</field></block></value></block></value><value name=\"B\"><block type=\"logic_compare\" id=\"198\" inline=\"true\"><field name=\"OP\">EQ</field><value name=\"A\"><block type=\"variables_get\" id=\"199\"><field name=\"VAR\">relais</field></block></value><value name=\"B\"><block type=\"math_number\" id=\"200\"><field name=\"NUM\">1</field></block></value></block></value></block></value><statement name=\"DO1\"><block type=\"procedures_callnoreturn\" id=\"201\"><mutation name=\"ouvre relais\"></mutation><next><block type=\"video_pause\" id=\"211\"></block></next></block></statement></block></statement></block>",
  "codejs": "var seuil;\nvar v;\nvar relais;\n\nfunction ouvre_relais() {\n  writeDigital(\"IO3\",0);relais = 0;\n}\n\nfunction ferme_relais() {\n  writeDigital(\"IO3\",1);relais = 1;\n}\n\n\nseuil = 0.15;\nouvre_relais();\nplayMediaLoop('/home/pi/media/sintel_trailer-480p.mp4');\n\n// Exemple : actionne une relais en fonction de la proximité d'une personne\n\n// Pour faire fonctionner cet exemple :\n// - brancher un relais sur IO3\n// - brancher un capteur de proximité (type maxbotics EZ) sur AN0\nonAnalog(0,function(v){\n  if (v < seuil && relais == 0) {\n    ferme_relais();\n    resumeMedia();\n  } else if (v >= seuil && relais == 1) {\n    ouvre_relais();\n    pauseMedia();\n  }\n});\n",
  "codepy": ""
}